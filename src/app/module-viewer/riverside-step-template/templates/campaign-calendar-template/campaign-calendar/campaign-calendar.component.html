<div class="container mx-auto">
  <button type="button"
          class="btn btn-primary mt-4"
          (click)="openModal()"
          *ngIf="!readonly"
  >
    Add campaign
  </button>

  <table class="table table-hover mt-3">
    <thead>
      <tr>
        <th scope="col" style="width: 12%"></th>
        <th scope="col" style="width: 20%">Theme</th>
        <th scope="col" style="width: 20%">Persona</th>
        <th scope="col" style="width: 15%">Messaging</th>
        <th scope="col">Tactical Map</th>
        <th scope="col" style="width: 9%">Start Date</th>
        <th scope="col" style="width: 9%">End Date</th>
        <th scope="col" style="width: 10%">Assigned</th>
      </tr>
    </thead>
    <tbody>
    <ng-container *ngFor="let campaign of campaigns; trackBy: trackByFn">
      <tr (dblclick)="editCampaign(campaign)">
        <td>
          <ng-container  *ngIf="!readonly">
            <i class="material-icons" (click)="editCampaign(campaign)">create</i>
            <i class="material-icons ml-1" (click)="deleteCampaign(campaign)">delete</i>
          </ng-container>
        </td>
        <td class="d-flex align-items-center">
          <div class="rounded-circle circle" [style.backgroundColor]="campaign.color || 'red'"></div>
          <div class="ml-2 text-break">{{campaign.theme}}</div>
        </td>
        <td>{{campaign.persona | personaName | async}}</td>
        <td>{{campaign.messaging}}</td>
        <td>{{campaign.tacticalMap}}</td>
        <td>{{campaign.startDate ? (campaign.startDate | readabledate) : ''}}</td>
        <td>{{campaign.endDate ? (campaign.endDate | readabledate) : ''}}</td>
        <td>{{campaign.assigned}}</td>
      </tr>
    </ng-container>
    </tbody>
  </table>

    <ng-container *ngFor="let year of years">

      <h5 class="mt-3">{{year}}</h5>
      <table class="table table-bordered mt-2" #tableWidth>
        <thead>
        <tr>
          <th scope="col" #tableLabel>Campaign</th>
          <th scope="col" *ngFor="let month of months" style="width: 6%">{{month}}</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let campaign of campaignGraphs[year]; trackBy: trackByFn">
          <th scope="row" class="position-relative text-break">
            {{campaign.theme}}
            <div
                class="campaign-line"
                placement="top"
                tooltipClass="tooltip"
                ngbTooltip="{{campaign.startDate ? (campaign.startDate | readabledate) : ''}} to {{campaign.endDate ? (campaign.endDate | readabledate) : ''}}"
                (dblclick)="editCampaign(campaign)"
                [style.backgroundColor]="campaign.color || 'red'"
                [style.width.px]="getCampaignWidth(tableWidth, tableLabel, campaign)"
                [style.left.px]="getCampaignOffset(tableWidth, tableLabel, campaign)"
            ></div>
          </th>
          <td *ngFor="let month of months"></td>
        </tr>
        </tbody>
      </table>

    </ng-container>
</div>
